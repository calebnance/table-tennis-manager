$(document).ready(function(){var a,e,s=3;$("#match-add").on("click",function(a){return a.preventDefault(),$(this).hasClass("disabled")?!1:void $.validateForm(!0)}),$("#match_created_form").on("click",".plus, .minus",function(a){if(a.preventDefault(),$pts_to_win=parseInt($("#pts_to_win").val()),$value=$(this).closest(".controls").find("input").val(),$player_num=$(this).closest(".player-area").attr("data-id"),1==$player_num?$other_player_score=parseInt($("#score_2").val()):$other_player_score=parseInt($("#score_1").val()),$(this).hasClass("minus")){if(0==$value)return!1;$value--}else if($(this).hasClass("plus")){if($value==$pts_to_win)return!1;if($other_player_score==$pts_to_win&&$(this).closest(".controls").find("input").hasClass("scoring"))return!1;$value++}$(this).closest(".controls").find("input").val($value),s=3,clearInterval(e),$.autoUpdate()}),$("#match-complete").on("click",function(a){var e=$("#match_created_form").serialize();e+="&completed=1",$.ajax({url:"match-add.php",type:"POST",dataType:"json",data:e}).done(function(a){$("#match-complete").addClass("btn-success").removeClass("btn-navy").html('<i class="fa fa-check"></i> Match Saved!'),$("#player1-area, #player2-area, .verses, #match-updating").fadeOut(400),setTimeout(function(){location.reload()},2e3)}).fail(function(){console.log("FAILED UPDATE: #match-complete click")})}),$.playerServe=function(){$match_created=$("#match_created_form"),$p1_score=parseInt($("#score_1").val()),$p2_score=parseInt($("#score_2").val()),$total_score=$p1_score+$p2_score,$serve_first=parseInt($("#serve_first").val()),$player_first=$match_created.find('label[data-player-id="'+$serve_first+'"]').attr("id"),$player_first="player1-label"==$player_first?"player1-label":"player2-label",$player_second="player1-label"==$player_first?"player2-label":"player1-label",$pts_per_turn=parseInt($("#pts_per_turn").val()),$skunk=parseInt($("#skunk").val()),$pts_to_win=parseInt($("#pts_to_win").val());var a=[0,1,4,5,8,9,12,13,16,17,20];$("#player1-msg").html(""),$("#player2-msg").html(""),0==parseInt($("#score_2").val())&&parseInt($("#score_1").val())==$skunk-1?$("#player2-msg").html('<span class="label label-info">A skunk is close...</span>'):0==parseInt($("#score_1").val())&&parseInt($("#score_2").val())==$skunk-1&&$("#player1-msg").html('<span class="label label-info">A skunk is close...</span>'),0==parseInt($("#score_2").val())&&parseInt($("#score_1").val())==$skunk?($("#player1-msg").html('<span class="label label-success">Winner</span>'),$("#player2-msg").html('<span class="label label-danger">You have been skunked!</span>')):0==parseInt($("#score_1").val())&&parseInt($("#score_2").val())==$skunk&&($("#player2-msg").html('<span class="label label-success">Winner</span>'),$("#player1-msg").html('<span class="label label-danger">You have been skunked!</span>')),$.inArray($total_score,a)>=0||0==$total_score?($("#"+$player_first).addClass("serving"),$("#"+$player_second).removeClass("serving")):($("#"+$player_second).addClass("serving"),$("#"+$player_first).removeClass("serving")),$pts_to_win-1==$p1_score?($("#"+$player_second).addClass("serving"),$("#"+$player_first).removeClass("serving")):$pts_to_win-1==$p2_score&&($("#"+$player_first).addClass("serving"),$("#"+$player_second).removeClass("serving")),$pts_to_win-1==$p1_score&&$pts_to_win-1==$p2_score&&($("#player1-msg").html('<span class="label label-info">Deuce</span>'),$("#player2-msg").html('<span class="label label-info">Deuce</span>'),$(".serving").removeClass("serving")),$pts_to_win==$p1_score&&$pts_to_win!=$p2_score&&($("#player1-msg").html('<span class="label label-success">Winner</span>'),$("#player2-msg").html(""),$(".serving").removeClass("serving")),$pts_to_win!=$p1_score&&$pts_to_win==$p2_score&&($("#player1-msg").html(""),$("#player2-msg").html('<span class="label label-success">Winner</span>'),$(".serving").removeClass("serving"))},$.autoUpdate=function(){$.playerServe(),$match_updating=$("#match-updating"),$match_updating.addClass("alert-info").removeClass("alert-warning alert-success").html('updating in <span class="secs">'+s+'</span> second<span class="add_s">s</span>'),e=setInterval(function(){if(s-=1,0>=s)return void clearInterval(e);var a=1==s?"":"s";$("#match-updating").find("span.secs").html(s),$("#match-updating").find("span.add_s").html(a)},1e3),clearTimeout(a),a=setTimeout(function(){$match_updating.addClass("alert-success").removeClass("alert-warning alert-info").html("updated!");var a=$("#match_created_form").serialize();$.ajax({url:"match-add.php",type:"POST",dataType:"json",data:a}).done(function(a){}).fail(function(){console.log("FAILED UPDATE: $.autoUpdate")})},3e3)},$.validateForm=function(a){$fields=$("#match_add_form .required");var e=!0;$.each($fields,function(s,t){var l=$(t).val();$(t).attr("name");a&&(""==l?($(t).closest(".form-group").addClass("has-error").removeClass("has-success"),e=!1):$(t).closest(".form-group").removeClass("has-error").addClass("has-success"))}),a&&e&&($("#match-add").html("Creating Match..").addClass("disabled"),$.ajax({url:"match-add.php",type:"POST",dataType:"json",data:$("#match_add_form").serialize()}).done(function(a){a.error?($("#message-area").hide().html('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+a.msg+"</div>").slideDown(400),$("#match-add").html("Start Match").removeClass("disabled")):($("#match_id").val(a.match_id),$("#player1_id").val(a.player1),$("#player2_id").val(a.player2),$("#pts_per_turn").val(a.pts_per_turn),$("#pts_to_win").val(a.pts_to_win),$("#skunk").val(a.skunk),$("#serve_first").val(a.serve_first),$.ajax({url:"match-add.php",type:"POST",dataType:"json",data:a}).done(function(e){$match_add=$("#match_add_form"),$match_created=$("#match_created_form"),$match_add.fadeOut(400),$match_created.delay(400).fadeIn(400),$match_created.find("#player1-label").html(e.player1.username).attr("data-player-id",a.player1),$match_created.find("#player2-label").html(e.player2.username).attr("data-player-id",a.player2),$match_created.find('label[data-player-id="'+a.serve_first+'"]').addClass("serving")}).fail(function(){$("#message-area").hide().html('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>Something went wrong! Please reload the page and try again.</div>').slideDown(400)}))}).fail(function(){$("#message-area").hide().html('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>Something went wrong! Please reload the page and try again.</div>').slideDown(400)}))}});
